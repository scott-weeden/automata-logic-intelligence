# pytest.ini - Configuration for pytest testing framework
[pytest]
# Minimum version
minversion = 7.0

# Test discovery patterns
python_files = test_*.py *_test.py
python_classes = Test* *Tests
python_functions = test_*

# Default command line options
addopts = 
    # Verbosity and output
    -v
    --strict-markers
    --tb=short
    --color=yes
    
    # Coverage options
    --cov=automata_lib
    --cov-report=html
    --cov-report=term-missing:skip-covered
    --cov-fail-under=80
    
    # Performance
    --durations=10
    --timeout=10
    
    # Parallel execution
    -n auto
    
    # Fail fast for student exercises
    --maxfail=3
    
    # Show local variables in tracebacks
    --showlocals
    
    # Capture output for debugging
    --capture=no
    -s

# Test paths
testpaths = 
    tests
    student_solutions
    exercises

# Python path additions
pythonpath = 
    src
    .

# Coverage configuration
[coverage:run]
source = automata_lib
omit = 
    */tests/*
    */test_*.py
    */__pycache__/*
    */site-packages/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod

# Markers for organizing tests
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    student: marks test as student exercise
    demo: marks test as demonstration
    undecidable: marks test as undecidability demo
    integration: marks test as integration test
    unit: marks test as unit test
    tm: marks test as Turing Machine test
    dfa: marks test as DFA test
    nfa: marks test as NFA test
    acceptance: marks test as acceptance test
    visual: marks test that produces visual output
    
# Plugins
plugins = 
    cov
    timeout
    xdist
    mock

# Output options
console_output_style = progress
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Doctest configuration
doctest_optionflags = 
    NORMALIZE_WHITESPACE
    IGNORE_EXCEPTION_DETAIL
    ALLOW_UNICODE

# Warning filters
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning

# Timeout settings
timeout = 10
timeout_method = thread

# xdist (parallel testing) settings
addopts = -n auto
looponfailroots = 
    src
    tests
    student_solutions